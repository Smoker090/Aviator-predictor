<!DOCTYPE html>
<html>
<head>
  <title>CrashSense Aviator Predictor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f9f9f9; }
    input, button { font-size: 16px; padding: 10px; width: 100%; margin-bottom: 10px; }
    .entry { border-bottom: 1px solid #ccc; padding: 5px 0; }
    .high { background: #c8f7c5; }
    .low { background: #f7c5c5; }
    .medium { background: #f0f0f0; }
    canvas { max-width: 100%; margin-top: 20px; }
  </style>
</head>
<body>
  <h2>ğŸš€ CrashSense Aviator Predictor</h2>

  <label>Server Seed (from Africabet):</label>
  <input type="text" id="serverSeed" placeholder="Paste revealed seed">

  <label>Client Seed:</label>
  <input type="text" id="clientSeed" value="PolitePredictor">

  <label>Nonce (Round Number):</label>
  <input type="number" id="nonce" placeholder="e.g. 123456">

  <button onclick="verifyAndTrain()">Verify & Train</button>
  <div id="result" style="margin-top:10px; font-weight:bold;"></div>

  <h3>ğŸ“Š Crash History</h3>
  <div id="history"></div>

  <h3>ğŸ§  CrashSense Prediction</h3>
  <div id="prediction"></div>

  <canvas id="crashChart" height="200"></canvas>

  <script>
    let recentRounds = [];

    function verifyAndTrain() {
      const serverSeed = document.getElementById("serverSeed").value.trim();
      const clientSeed = document.getElementById("clientSeed").value.trim();
      const nonce = parseInt(document.getElementById("nonce").value);

      const input = `${serverSeed}:${clientSeed}:${nonce}`;
      const hash = CryptoJS.SHA256(input).toString();
      const crash = getCrashMultiplier(hash);

      document.getElementById("result").innerText = `Crash Multiplier: ${crash}x`;

      saveToHistory(serverSeed, clientSeed, nonce, crash);
      updateHistoryDisplay();
      updateCrashSense(crash);
      updateChart();
    }

    function getCrashMultiplier(hash) {
      const h = parseInt(hash.slice(0, 13), 16);
      if (h % 33 === 0) return 1.00;
      return Math.floor((100 * (2 ** 32 - 1) / (2 ** 32 - h)) * 100) / 100;
    }

    function saveToHistory(serverSeed, clientSeed, nonce, crash) {
      const entry = { serverSeed, clientSeed, nonce, crash };
      const history = JSON.parse(localStorage.getItem("crashHistory") || "[]");
      history.unshift(entry);
      localStorage.setItem("crashHistory", JSON.stringify(history.slice(0, 20)));
    }

    function updateHistoryDisplay() {
      const history = JSON.parse(localStorage.getItem("crashHistory") || "[]");
      const container = document.getElementById("history");
      container.innerHTML = "";
      history.forEach(entry => {
        const colorClass = entry.crash >= 10 ? "high" : entry.crash <= 1.5 ? "low" : "medium";
        container.innerHTML += `<div class="entry ${colorClass}">
          <strong>${entry.crash}x</strong> â€” Nonce: ${entry.nonce}
        </div>`;
      });
    }

    function updateCrashSense(newCrash) {
      recentRounds.unshift(newCrash);
      if (recentRounds.length > 20) recentRounds.pop();

      const risk = detectCrashRisk(recentRounds);
      const pink = detectPinkRound(recentRounds);
      const confidence = calculateConfidence(risk, pink);

      const alert = risk === "High" ? "âš ï¸ Avoid early jumps!" :
                    pink === "Likely" ? "ğŸ¯ Stay longer â€” pink round possible!" : "";

      document.getElementById("prediction").innerHTML = `
        ğŸ”´ Risk Level: <strong>${risk}</strong><br>
        ğŸŒ¸ Pink Round Chance: <strong>${pink}</strong><br>
        ğŸ“ˆ Confidence Score: <strong>${confidence}%</strong><br>
        <div style="margin-top:10px; color:#d00;">${alert}</div>
      `;
    }

    function detectCrashRisk(rounds) {
      const lowCrashes = rounds.filter(r => r <= 1.5).length;
      return lowCrashes >= 5 ? "High" : lowCrashes >= 3 ? "Medium" : "Low";
    }

    function detectPinkRound(rounds) {
      const highCrashes = rounds.filter(r => r >= 10).length;
      return highCrashes >= 2 ? "Likely" : "Unlikely";
    }

    function calculateConfidence(risk, pink) {
      if (risk === "High") return 90;
      if (pink === "Likely") return 80;
      return 50;
    }

    function updateChart() {
      const history = JSON.parse(localStorage.getItem("crashHistory") || "[]");
      const labels = history.map((e, i) => `#${e.nonce || i + 1}`);
      const data = history.map(e => e.crash);

      const ctx = document.getElementById("crashChart").getContext("2d");
      if (window.crashChart) window.crashChart.destroy();
      window.crashChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Crash Multiplier',
            data: data,
            borderColor: '#0077cc',
            backgroundColor: 'rgba(0,119,204,0.2)',
            fill: true,
            tension: 0.3
          }]
        },
        options: {
          scales: {
            y: { beginAtZero: true }
          }
        }
      });
    }

    updateHistoryDisplay();
    updateChart();
  </script>
</body>
</html>
